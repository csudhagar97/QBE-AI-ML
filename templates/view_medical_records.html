{% extends 'main.html' %}
{% load static %}
{% block title %}View Medical Records{% endblock title %}
{% block content %}
<div class="h-[90vh] w-full flex flex-col items-center justify-center relative">
    <img src="{% static 'another-bg.jpg' %}" alt="" class="h-[90vh] w-screen object-cover absolute top-0 left-0">
    <div class="w-[80vw] bg-white rounded-xl p-8 shadow-xl z-50">
        <h1 class="text-[35px] leading-[50px] font-bold mb-6">Medical Records</h1>
        {% if records %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for record in records %}
                    <div class="bg-gray-100 p-4 rounded-lg shadow-md">
                        <p class="font-semibold">User: {{ record.user.username }}</p>
                        <p>Description: {{ record.description }}</p>
                        <p>Uploaded on: {{ record.uploaded_at }}</p>
                        <a href="{{ record.file.url }}" class="text-cyan-500 underline" target="_blank" onclick="sendNotification({{ record.id }})">View File</a>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No medical records found.</p>
        {% endif %}
    </div>
</div>

<script>
function sendNotification(recordId) {
    fetch("{% url 'send_notification' %}", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({
            record_id: recordId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (!data.success) {
            alert(data.message);
        }
    })
    .catch(error => console.error('Error:', error));
}
</script>
{% endblock content %}
