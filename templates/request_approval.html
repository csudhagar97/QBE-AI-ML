{% extends 'main.html' %}

{% block title %}
    Confirm Request Approval
{% endblock title %}

{% block content %}
<div class="container mx-auto py-8">
    <h1 class="text-3xl font-bold mb-4">Confirm Request Approval</h1>
    <div id="message" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4" role="alert">
        <span class="block sm:inline" id="message-text"></span>
    </div>
    <form id="confirm-approval-form">
        {% csrf_token %}
        <input type="hidden" name="file_id" value="{{ file_id }}">
        <button type="submit" class="text-white font-semibold px-6 py-2 bg-emerald-500 hover:bg-emerald-600 cursor-pointer rounded-lg transition duration-300 ease-in-out">Confirm Request Approval</button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    document.getElementById('confirm-approval-form').addEventListener('submit', function (event) {
        event.preventDefault();

        const formData = new FormData(this);
        const csrfToken = formData.get('csrfmiddlewaretoken');
        const fileId = formData.get('file_id');

        fetch("{% url 'request_approval' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                file_id: fileId
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const messageDiv = document.getElementById('message');
                const messageText = document.getElementById('message-text');
                messageText.textContent = data.message;
                messageDiv.classList.remove('hidden');
            }
        })
        .catch(error => console.error('Error:', error));
    });
});
</script>
{% endblock content %}
